# CTF - Lazy Dev
A beginner-friendly Capture The Flag challenge running on a single Linux VM. You explore a web application and the underlying system to find **5 flags**. Doable with minimal experience in about 2–3 hours.

**Disclaimer**: This README was partially generated by AI and may not be fully correct.
## Overview

The VM hosts a Node.js web application ("Internal Dev Portal") and several system-level misconfigurations. No credentials are provided. You need to find them yourself or exploit the system to bypass authentication.

### Attack Surface

| Service | Port | Description |
|---------|------|-------------|
| HTTP    | 3000 | Node.js internal dev portal |
| SSH     | 22   | Remote shell access |


## Installation

### Prerequisites

- An Ubuntu Server VM (24.04 LTS recommended)
- ISO download: https://releases.ubuntu.com/24.04.2/ubuntu-24.04.2-live-server-amd64.iso

During OS installation, use these settings:
- **Language:** English
- **Base:** Ubuntu Server (not minimized)
- **OpenSSH server:** Install

### Setup

Once the OS is installed, log in as `root` and run:

```bash
git clone https://github.com/CaptnBash/CTF-LazyAdmin.git
bash CTF-LazyAdmin/install.sh
```

The script installs all dependencies, configures users, deploys the web application, and places the flags. Once it finishes, reboot or power off the VM. Now you are ready for the challenge.

> **Note:** The setup script removes the installation user and cleans up the repo from disk. Make sure you are logged in as `root` when running it.

## How to Play

You know the following:

- The VM's **IP address** (displayed on the login screen)
- A **website** is running on port `3000`
- **SSH** is available on port `22`
- Two users exist on the system: `dev` and `www-data`
- There are **5 flags** to find, in the format `flag{...}`

Everything else is up to you. Find the credentials, explore the system, and collect all flags.


## Hints
<details>
<summary>Click to reveal</summary>

Three flags are at known locations:

| # | Location |
|---|----------|
| 1 | `/home/dev/flag.txt` |
| 2 | `/var/www/flag.txt` |
| 3 | `/root/flag.txt` (requires privilege escalation) |

The remaining two flags are hidden. Here are your only leads:

**The "Esoteric" Secret:** Encoded data has been detected within the frontend source. Our linguists believe the architect used an "esoteric" logic that standard eyes will overlook.

**The "Archive" Flag:** Our forensic team believes a secret was accidentally leaked in a previous version of the project's development history.

**Dev User**: It is known that the `dev` user is very lazy at setting his passwords. 


### Walkthrough

<details>
<summary>Show walkthrough</summary>

#### Flag 1 — `/home/dev/flag.txt`

The `dev` user is known to be lazy with passwords. Guess the credentials (`dev` / `dev123`), SSH into the machine, and read the flag:

```bash
ssh dev@<IP>
cat ~/flag.txt
```

#### Flag 2 — Cookie Forgery + Command Injection → `/var/www/flag.txt`

1. Visit the web app on port 3000 and log in. The app sets a Base64-encoded session cookie called `secure_session_data`.
2. Decode the cookie value — it contains a JSON object like `{"id":105,"role":"dev"}`.
3. Forge an admin session by encoding `{"id":105,"role":"admin"}` as Base64:
   ```bash
   echo -n '{"id":105,"role":"admin"}' | base64
   ```
4. Replace the cookie value in your browser with the result. The admin panel ("Network Diagnostic Tool") becomes accessible.
5. The ping input is vulnerable to command injection. Use it to read the `www-data` password:
   ```
   8.8.8.8 ; cat /var/www/html/password.txt
   ```
6. SSH in as `www-data` with the password you found and read the flag:
   ```bash
   ssh www-data@<IP>
   cat /var/www/flag.txt
   ```

#### Flag 3 — Esoteric Language in HTML Source

Inspect the HTML source of the web app. At the bottom there is a hidden `<secret>` element containing Brainfuck code. Copy the code and run it through a Brainfuck interpreter to reveal the flag.

#### Flag 4 — Git History

A backup archive (`source.zip`) is available on the system (in `/home/dev/`). Extract it and inspect the git history:

```bash
unzip source.zip
cd root/source
git log --oneline
git show <first-commit-hash>
```

The flag was committed in the initial commit and then removed in a subsequent one.

#### Flag 5 — Privilege Escalation → `/root/flag.txt`

1. As `www-data`, look at `ToDo.txt`. It states that there is a cronjob running as root every 2 minutes. It executes the script `/opt/backup.sh`:
   ```bash
   cat /opt/backup.sh
   ```
   The backup script sources `/var/scripts/env_setup.sh` if it exists.
2. The directory `/var/scripts/` is writable by the `www-data` group. Create the hook script:
   ```bash
   echo 'cp /root/flag.txt /tmp/flag.txt' > /var/scripts/env_setup.sh
   ```
3. Wait up to 2 minutes for the cron job to execute, then read the flag:
   ```bash
   cat /tmp/flag.txt
   ```

</details>


### All Flags

<details>
<summary>Show flags</summary>

```
flag{Th1s_d0es_n0t_l00k_g00d!}
flag{WHAT_A_N1CE_L4NGU4GE!}
flag{BASE64_1S_N0T_ENCRYPT10N}
flag{G1t_H1st0ry_Secr3ts_L1VE_0N!}
flag{TH3_CR0N_JOB_W1NS}
```

</details>
</details>
